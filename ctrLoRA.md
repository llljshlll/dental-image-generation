# ğŸ§  CtrLoRA: AN EXTENSIBLE AND EFFICIENT FRAMEWORK FOR CONTROLLABLE IMAGE GENERATION

>  ì›ë¬¸ ë…¼ë¬¸: [ICLR 2025](https://github.com/xyfJASON/ctrlora)  
>  ì €ì: Yifeng Xu, Zhenliang He, Shiguang Shan, Xilin Chen

---

## Overview

**CtrLoRA**ëŠ” ê¸°ì¡´ **ControlNet**ì˜ êµ¬ì¡°ì  í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ì œì•ˆëœ  
**í™•ì¥ ê°€ëŠ¥(extensible)** í•˜ê³  **íš¨ìœ¨ì ì¸(efficient)** ì œì–´í˜• ì´ë¯¸ì§€-íˆ¬-ì´ë¯¸ì§€(Image-to-Image, I2I) ìƒì„± í”„ë ˆì„ì›Œí¬

ControlNetì€ ìƒˆë¡œìš´ ì¡°ê±´(condition)ì„ ì¶”ê°€í•  ë•Œë§ˆë‹¤  
ìˆ˜ë°±ë§Œ ê°œì˜ ë°ì´í„°ìŒê³¼ ìˆ˜ë°± ì‹œê°„ì˜ GPU í•™ìŠµì´ í•„ìš”í–ˆì§€ë§Œ,  
CtrLoRAëŠ” ì´ë¥¼ **Base ControlNet + LoRA êµ¬ì¡°**ë¡œ ì¬ì„¤ê³„í•˜ì—¬  
**ë‹¨ 1,000ê°œì˜ ë°ì´í„°ìŒê³¼ ë‹¨ì¼ GPU 1ì‹œê°„ ë¯¸ë§Œì˜ í•™ìŠµë§Œìœ¼ë¡œë„ ìƒˆë¡œìš´ ì¡°ê±´ì„ í•™ìŠµ**í•  ìˆ˜ ìˆë„ë¡ í•¨

---

## ë¬¸ì œ ë°°ê²½

| ControlNetì˜ í•œê³„ | ì˜í–¥ |
|-------------------|------|
| ê° ì¡°ê±´ë§ˆë‹¤ ë…ë¦½ì ì¸ ëª¨ë¸ í•™ìŠµ í•„ìš” (Canny, Depth, Pose ë“±) | ë§¤ìš° ë¹„íš¨ìœ¨ì  |
| ì¡°ê±´ë³„ë¡œ ìˆ˜ë°±ë§Œ ê°œì˜ ë°ì´í„° í•„ìš” | ë§‰ëŒ€í•œ ë¹„ìš© ë°œìƒ |
| 500~600 GPU ì‹œê°„ ì†Œìš” | ì¼ë°˜ ì—°êµ¬ì ì ‘ê·¼ ë¶ˆê°€ |
| ì¡°ê±´ ì¶”ê°€ ë° í™•ì¥ ì–´ë ¤ì›€ | ì‹¤í—˜ ë° ì»¤ë®¤ë‹ˆí‹° í™•ì¥ ì €í•´ |

---

## CtrLoRAì˜ ëª©í‘œ

CtrLoRAì˜ í•µì‹¬ ëª©í‘œëŠ” ë‹¨ìˆœíˆ â€œì ì€ ìì›ìœ¼ë¡œ í•™ìŠµí•˜ëŠ” ëª¨ë¸â€ì´ ì•„ë‹ˆë¼,  
**ControlNetì„ ëª¨ë“ˆí˜•ìœ¼ë¡œ ì¬êµ¬ì„±í•˜ì—¬ ìƒˆë¡œìš´ ì¡°ê±´ì„ ë¹ ë¥´ê³  ì‰½ê²Œ í™•ì¥í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ê²ƒ**

### ì„¸ë¶€ ëª©í‘œ

1. **Base ControlNet**
   - ì—¬ëŸ¬ ì¡°ê±´(Canny, Depth, Skeleton ë“±)ì„ ë™ì‹œì— í•™ìŠµì‹œì¼œ  
     ë‹¤ì–‘í•œ I2I ìƒì„±ì˜ ì¼ë°˜ì  ì›ë¦¬ë¥¼ ìŠµë“
   - ì´í›„ ìƒˆë¡œìš´ ì¡°ê±´ í•™ìŠµì˜ ê¸°ë°˜ ëª¨ë¸ë¡œ í™œìš©

2. **Condition-specific LoRA**
   - Base ControlNetì€ ê³ ì •(frozen)í•˜ê³ ,  
     ê° ì¡°ê±´ì— ë§ëŠ” LoRAë§Œ í•™ìŠµ â†’ íš¨ìœ¨ì ìœ¼ë¡œ ì°¨ë³„í™”ëœ íŠ¹ì„± ë°˜ì˜  
   - íŒŒë¼ë¯¸í„° ìˆ˜ë¥¼ ì•½ **90% ì ˆê° (361M â†’ 37M per condition)**

3. **Fast Adaptation**
   - ìƒˆë¡œìš´ ì¡°ê±´ë„ Base ControlNetì„ ìœ ì§€í•œ ì±„ LoRAë§Œ í•™ìŠµ  
   - **1,000ê°œ ë°ì´í„°ìŒ, RTX 4090 1ì‹œê°„ ì´ë‚´ í•™ìŠµ**ìœ¼ë¡œ ì¶©ë¶„

4. **Composability & Extensibility**
   - ì—¬ëŸ¬ LoRAë¥¼ ê²°í•©í•´ **ë‹¤ì¤‘ ì¡°ê±´(Multi-condition) ìƒì„±** ê°€ëŠ¥  
   - Stable Diffusion ê¸°ë°˜ ì»¤ë®¤ë‹ˆí‹° ëª¨ë¸(Realistic Vision, Mistoon ë“±)ì— **Plug-and-Play í†µí•©** ê°€ëŠ¥

---

## âš™ï¸ êµ¬ì¡° ê°œìš”

![CtrLoRA êµ¬ì¡°](images/ctrlora_framework.png)

CtrLoRAëŠ” ì„¸ ê°€ì§€ í•µì‹¬ êµ¬ì„±ìš”ì†Œë¡œ ì´ë£¨ì–´ì§

1. **Base ControlNet** â€“ ì—¬ëŸ¬ ì¡°ê±´ì˜ ê³µí†µì ì¸ ìƒì„± ëŠ¥ë ¥ í•™ìŠµ  
2. **Condition-specific LoRA** â€“ ì¡°ê±´ë³„ ê³ ìœ  íŠ¹ì„± í•™ìŠµ  
3. **Condition Embedding Network (VAE)** â€“ ì¡°ê±´ ì´ë¯¸ì§€ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ latent ê³µê°„ìœ¼ë¡œ ì„ë² ë”©


ê¸°ì¡´ controlNet ëª¨ë¸ê³¼ ë™ì¼í•œ êµ¬ì¡°ì˜ Base ControlNetì— LoRAë¥¼ switchingí•˜ë©° condition ë³„ ê³ ìœ  íŠ¹ì„±ì„ í•™ìŠµ ì‹œí‚¤ëŠ” ê²ƒ
ë˜í•œ, conditionì„ ë°›ì•„ì˜¬ ë•Œ, zero convolutionìœ¼ë¡œ ë°›ì•„ì˜¤ì§€ë§Œ, ctrLoRAëŠ” conditionì„ VAEë¡œ ë°›ì•„ì™€ì„œ ì„ë² ë”©í•¨
ctrLoRA VS controlNet
![CtrLoRA êµ¬ì¡°](images/ctrLoRA_controlNet.png)

---

## ğŸ§± Base ControlNet: ê³µí†µ ì§€ì‹ í•™ìŠµ

### í•™ìŠµ ëª©í‘œ

- ì—¬ëŸ¬ ì¡°ê±´ì—ì„œ ê³µí†µì ì¸ ì´ë¯¸ì§€-íˆ¬-ì´ë¯¸ì§€ ìƒì„± ì›ë¦¬ë¥¼ í•™ìŠµ  
- ì¡°ê±´ë³„ë¡œ LoRAë¥¼ ì—°ê²°í•œ ì±„ ì „ì²´ íŒŒë¼ë¯¸í„°ë¥¼ ê³µìœ í•˜ì—¬ í•™ìŠµ

**í•™ìŠµ ì¡°ê±´ (ì´ 9ê°€ì§€):**  
Canny, Depth, HED, Skeleton, Segmentation, Normal, Outpainting, Bounding Box, Sketch

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë°ì´í„°ì…‹ | MultiGen-20M (2ì²œë§Œ ìŒ) |
| GPU ì‹œê°„ | ì•½ 6,000ì‹œê°„ (RTX4090 ê¸°ì¤€) |
| í•™ìŠµ ëª©ì  | ê³µí†µ ì§€ì‹(common knowledge) íšë“ |
| ì†ì‹¤í•¨ìˆ˜ | ì¡°ê±´ë³„ LoRAë¥¼ í•©ì¹œ ë‹¤ì¤‘ ì¡°ê±´ ê³µë™ ìµœì í™” |

---

## ğŸ§© LoRA: ê²½ëŸ‰í™”ëœ ì¡°ê±´ë³„ í•™ìŠµ

| í•­ëª© | ë‚´ìš© |
|------|------|
| íŒŒë¼ë¯¸í„° êµ¬ì¡° | ì €ë­í¬ ë¶„í•´ Î”W = BA |
| Rank | 128 (ê¸°ë³¸ê°’) |
| ì¡°ê±´ë³„ í•™ìŠµ íŒŒë¼ë¯¸í„° | 37M (ControlNet ëŒ€ë¹„ -90%) |
| í•™ìŠµ ì‹œê°„ | ì•½ 1ì‹œê°„ (ë‹¨ì¼ GPU) |
| ë°ì´í„°ëŸ‰ | ì•½ 1,000ìŒ |
| Base ëª¨ë¸ | ê³ ì •(frozen), LoRAë§Œ ì—…ë°ì´íŠ¸ |

> ì—¬ëŸ¬ ì¡°ê±´ì— ëŒ€í•´ í•™ìŠµëœ LoRAëŠ” ì„œë¡œ **í•©ì„±(blending)** ë˜ì–´  
> í•œ ë²ˆì˜ ì¶”ë¡ ìœ¼ë¡œ ë‹¤ì¤‘ ì¡°ê±´ ì œì–´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ğŸ§  Condition Embedding Network (VAE í™œìš©)

CtrLoRAëŠ” ê¸°ì¡´ ControlNetì˜ ë¬´ì‘ìœ„ ì´ˆê¸°í™” CNN ëŒ€ì‹   
**Stable Diffusionì˜ ì‚¬ì „í•™ìŠµëœ VAE ì¸ì½”ë”**ë¥¼ ì¡°ê±´ ì„ë² ë”© ë„¤íŠ¸ì›Œí¬ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

| êµ¬ë¶„ | ê¸°ì¡´ ControlNet | **CtrLoRA (ours)** |
|------|------------------|--------------------|
| ì„ë² ë”© ë°©ì‹ | ë¬´ì‘ìœ„ CNN | **ì‚¬ì „í•™ìŠµ VAE ì¸ì½”ë”** |
| ControlNetê³¼ì˜ ê³µê°„ í˜¸í™˜ì„± | ë³„ë„ í•™ìŠµ í•„ìš” | **ì§ì ‘ í˜¸í™˜ (latent ê³µê°„ ë™ì¼)** |
| ìˆ˜ë ´ ì†ë„ | ëŠë¦¬ê³  ë¶ˆì•ˆì • | **ë§¤ìš° ë¹ ë¥´ê³  ì•ˆì •ì ** |
| Sudden convergence í˜„ìƒ | ë¹ˆë²ˆí•˜ê²Œ ë°œìƒ | **ë°œìƒí•˜ì§€ ì•ŠìŒ** |
| ì¥ì  | - | ê°•ë ¥í•œ ì´ë¯¸ì§€ í‘œí˜„ë ¥ + ì•ˆì •ì  ìˆ˜ë ´ |

> â€œVAEì˜ latent ê³µê°„ì€ Base ControlNet ì…ë ¥ ê³µê°„ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ë§ë¬¼ë¦¬ë©°,  
> í•™ìŠµ ì†ë„ë¥¼ íšê¸°ì ìœ¼ë¡œ í–¥ìƒì‹œí‚¤ê³  ë¶ˆì•ˆì •í•œ ìˆ˜ë ´ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.â€:contentReference[oaicite:1]{index=1}

---

## ğŸš€ ì¶”ë¡  (Inference) ë° ë‹¤ì¤‘ ì¡°ê±´ ìƒì„±

- Base ControlNetê³¼ í•˜ë‚˜ ì´ìƒì˜ LoRAë¥¼ ê²°í•©í•˜ì—¬ ì¶”ë¡   
- ê° LoRAì˜ ê°€ì¤‘ì¹˜ë¥¼ ì¡°ì ˆí•´ ì¡°ê±´ì˜ ì˜í–¥ë ¥ ì œì–´ ê°€ëŠ¥

\[
\text{Output} = C_\theta(x_t) + \sum_i w_i L_{\psi_i}(x_t, c_i)
\]

| êµ¬ì„± ìš”ì†Œ | íŒŒë¼ë¯¸í„° ìˆ˜ | ëª¨ë¸ í¬ê¸° |
|------------|-------------|------------|
| Base ControlNet | 830M | 1.54 GB |
| LoRA (ì¡°ê±´ë³„) | 78M | 148 MB |

âœ… **ë‹¤ì¤‘ ì¡°ê±´ ìƒì„± ì§€ì›**  
(ì˜ˆ: Depth + Segmentation â†’ ë‘ ì¡°ê±´ ëª¨ë‘ ì¶©ì¡±í•˜ëŠ” ì´ë¯¸ì§€ ìƒì„±)  
âœ… **Plug-and-Play í†µí•© ê°€ëŠ¥**  
Stable Diffusion 1.5 / Realistic Vision / Anime ëª¨ë¸ ë“±ê³¼ ë°”ë¡œ ì—°ë™ ê°€ëŠ¥

---

## ğŸ“Š ì‹¤í—˜ ê²°ê³¼ ìš”ì•½

### Base Condition ì„±ëŠ¥ (MultiGen-20M ê¸°ì¤€)

| ì¡°ê±´ | UniControl | **CtrLoRA (ours)** |
|------|-------------|--------------------|
| Canny | 0.273 / 18.58 | **0.388 / 16.65** |
| Depth | 0.216 / 21.29 | **0.222 / 19.34** |
| Skeleton | 0.129 / 53.64 | **0.132 / 51.40** |
| Segmentation | 0.467 / 22.02 | **0.465 / 21.13** |

### ìƒˆë¡œìš´ ì¡°ê±´ (1K ìƒ˜í”Œ, ë‹¨ì¼ GPU)

| ì¡°ê±´ | ControlNet | **CtrLoRA (ours)** |
|------|-------------|--------------------|
| Lineart | 0.622 / 22.29 | **0.305 / 16.12** |
| DensePose | 0.367 / 36.80 | **0.159 / 35.18** |
| Inpainting | 0.785 / 22.09 | **0.326 / 9.97** |
| Dehazing | 0.758 / 54.07 | **0.255 / 15.44** |

> âœ… íŒŒë¼ë¯¸í„° 90% ê°ì†Œ  
> âœ… ìˆ˜ë ´ ì†ë„ 10ë°° í–¥ìƒ  
> âœ… í’ˆì§ˆ ì†ì‹¤ ì—†ì´ ë™ì¼ ì„±ëŠ¥ ë‹¬ì„±

---

## ğŸ”¬ Ablation Study ìš”ì•½

| êµ¬ì„± ìš”ì†Œ ì¶”ê°€ | ê°œì„  íš¨ê³¼ |
|----------------|------------|
| + Pretrained VAE | í•™ìŠµ ì•ˆì •í™” ë° ë¹ ë¥¸ ìˆ˜ë ´ |
| + Base ControlNet | ìƒˆë¡œìš´ ì¡°ê±´ì— ëŒ€í•œ ì¼ë°˜í™” ì„±ëŠ¥ í–¥ìƒ |
| + LoRA Fine-tuning | íŒŒë¼ë¯¸í„° íš¨ìœ¨ í–¥ìƒ (ì„±ëŠ¥ ìœ ì§€) |

> ì „ì²´ íŒŒë¼ë¯¸í„°ì˜ 10%ë§Œ í•™ìŠµí•´ë„, í’€ ëª¨ë¸(ControlNet)ê³¼ ê±°ì˜ ë™ì¼í•œ í’ˆì§ˆì„ ë‹¬ì„±í•©ë‹ˆë‹¤.

---

## ğŸ¨ ì‘ìš© ë¶„ì•¼ (Applications)

1. **ë‹¤ì¤‘ ì¡°ê±´ ìƒì„± (Multi-Conditional Generation)**  
   - ì—¬ëŸ¬ LoRAë¥¼ ì¡°í•©í•´ Depth + Segmentation ë“± ë³µí•© ì œì–´ ê°€ëŠ¥  
2. **ìŠ¤íƒ€ì¼ ì „ì´ (Style Transfer)**  
   - ìƒ‰ìƒ(Palette) LoRAì™€ êµ¬ì¡°(Lineart) LoRAë¥¼ ê²°í•©  
3. **ì»¤ë®¤ë‹ˆí‹° í†µí•© (Community Integration)**  
   - Stable Diffusion 1.5, Realistic Vision, Mistoon, Oil Painting ë“± ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ ëª¨ë¸ê³¼ í˜¸í™˜  
4. **ì‹¤ì‹œê°„ ìƒì„± (Real-time Adaptation)**  
   - ê²½ëŸ‰ êµ¬ì¡°ë¡œ ì¸í„°ë™í‹°ë¸Œ ìƒì„± ì‹œìŠ¤í…œì— í™œìš© ê°€ëŠ¥

---

## ğŸ§¾ ë¹„êµ ìš”ì•½

| í•­ëª© | ControlNet | **CtrLoRA** |
|------|-------------|-------------|
| ë°ì´í„° ìˆ˜ | 3M+ | **1K** |
| GPU ì‹œê°„ | 500~600h | **1h ë¯¸ë§Œ** |
| íŒŒë¼ë¯¸í„° ìˆ˜ | 361M/ì¡°ê±´ | **37M/ì¡°ê±´** |
| í™•ì¥ì„± | ë‚®ìŒ | **ë†’ìŒ (ëª¨ë“ˆí˜• êµ¬ì¡°)** |
| ìˆ˜ë ´ ì†ë„ | ë¶ˆì•ˆì • | **ì•ˆì •ì , ë¹ ë¦„ (VAE ë•ë¶„)** |
| ë‹¤ì¤‘ ì¡°ê±´ | ë¶ˆê°€ëŠ¥ | **ê°€ëŠ¥ (LoRA í•©ì„±)** |

---

## ğŸ§­ ê²°ë¡  (Conclusion)

CtrLoRAëŠ” ê¸°ì¡´ ControlNetì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ë©°,  
ë‹¤ìŒ ì„¸ ê°€ì§€ë¥¼ ë™ì‹œì— ë‹¬ì„±í•œ í˜ì‹ ì ì¸ ì ‘ê·¼ë²•ì…ë‹ˆë‹¤:

1. **Extensibility (í™•ì¥ì„±)** â€” Base + LoRA êµ¬ì¡°ë¡œ ìƒˆë¡œìš´ ì¡°ê±´ ì†ì‰¬ìš´ ì¶”ê°€  
2. **Efficiency (íš¨ìœ¨ì„±)** â€” íŒŒë¼ë¯¸í„° 90% ê°ì†Œ, í•™ìŠµ 1ì‹œê°„ ì´ë‚´  
3. **Stability (ì•ˆì •ì„±)** â€” VAE ê¸°ë°˜ ì„ë² ë”©ìœ¼ë¡œ ìˆ˜ë ´ í–¥ìƒ ë° ë¶ˆì•ˆì • ì œê±°  

> ê²°ê³¼ì ìœ¼ë¡œ,  
> **CtrLoRAëŠ” ì œì–´í˜• ì´ë¯¸ì§€ ìƒì„± ëª¨ë¸ ê°œë°œì˜ ì§„ì…ì¥ë²½ì„ ë‚®ì¶”ê³ **,  
> ëˆ„êµ¬ë‚˜ íš¨ìœ¨ì ìœ¼ë¡œ ìƒˆë¡œìš´ ì¡°ê±´ ê¸°ë°˜ ControlNetì„ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

---

## ğŸ“š ì°¸ê³  ë¬¸í—Œ

- Xu et al., *CtrLoRA: An Extensible and Efficient Framework for Controllable Image Generation*, ICLR 2025  
- Zhang et al., *ControlNet: Adding Conditional Control to Text-to-Image Diffusion Models*, CVPR 2023  
- Hu et al., *LoRA: Low-Rank Adaptation of Large Language Models*, ICLR 2022  
- Qin et al., *UniControl: A Unified Diffusion Model for Controllable Visual Generation*, NeurIPS 2024
